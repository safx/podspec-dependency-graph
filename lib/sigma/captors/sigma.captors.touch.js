(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.captors"),sigma.captors.touch=function(t,a,e){function i(t){var a=sigma.utils.getOffset(q);return{x:t.pageX-a.left,y:t.pageY-a.top}}function o(t){if(P("touchEnabled")){var a,e,o,n,r,s;switch(C=t.touches,C.length){case 1:L.isMoving=!0,w=1,c=L.x,u=L.y,d=L.x,l=L.y,r=i(C[0]),y=r.x,v=r.y;break;case 2:return L.isMoving=!0,w=2,r=i(C[0]),s=i(C[1]),a=r.x,o=r.y,e=s.x,n=s.y,d=L.x,l=L.y,h=L.angle,g=L.ratio,c=L.x,u=L.y,y=a,v=o,p=e,f=n,M=Math.atan2(f-v,p-y),E=Math.sqrt(Math.pow(f-v,2)+Math.pow(p-y,2)),t.preventDefault(),!1}}}function n(t){if(P("touchEnabled")){C=t.touches;var a=P("touchInertiaRatio");switch(D&&(b=!1,clearTimeout(D)),w){case 2:if(1===t.touches.length){o(t),t.preventDefault();break}case 1:L.isMoving=!1,T.dispatchEvent("stopDrag"),b&&(k=!1,sigma.misc.animation.camera(L,{x:L.x+a*(L.x-d),y:L.y+a*(L.y-l)},{easing:"quadraticOut",duration:P("touchInertiaDuration")})),b=!1,w=0}}}function r(t){if(!k&&P("touchEnabled")){var a,e,o,n,r,s,q,O,I,z,R,Z,A,V,X,Y,j;switch(C=t.touches,b=!0,D&&clearTimeout(D),D=setTimeout(function(){b=!1},P("dragTimeout")),w){case 1:O=i(C[0]),a=O.x,o=O.y,z=L.cameraPosition(a-y,o-v,!0),V=c-z.x,X=u-z.y,(V!==L.x||X!==L.y)&&(d=L.x,l=L.y,L.goTo({x:V,y:X}),T.dispatchEvent("mousemove",{x:O.x-t.target.width/2,y:O.y-t.target.height/2}),T.dispatchEvent("drag"));break;case 2:O=i(C[0]),I=i(C[1]),a=O.x,o=O.y,e=I.x,n=I.y,R=L.cameraPosition((y+p)/2-t.target.width/2,(v+f)/2-t.target.height/2,!0),q=L.cameraPosition((a+e)/2-t.target.width/2,(o+n)/2-t.target.height/2,!0),Z=Math.atan2(n-o,e-a)-M,A=Math.sqrt(Math.pow(n-o,2)+Math.pow(e-a,2))/E,a=R.x,o=R.y,Y=g/A,a*=A,o*=A,j=h-Z,r=Math.cos(-Z),s=Math.sin(-Z),e=a*r+o*s,n=o*r-a*s,a=e,o=n,V=a-q.x+c,X=o-q.y+u,(Y!==L.ratio||j!==L.angle||V!==L.x||X!==L.y)&&(d=L.x,l=L.y,m=L.angle,x=L.ratio,L.goTo({x:V,y:X,angle:j,ratio:Y}),T.dispatchEvent("drag"))}return t.preventDefault(),!1}}function s(t){var a,e,o,n;return t.touches&&1===t.touches.length&&P("touchEnabled")?(k=!0,o=1/P("doubleClickZoomingRatio"),n=Math.max(P("zoomMin"),Math.min(P("zoomMax"),L.ratio*o)),o=n/L.ratio,n!==L.ratio&&(e=sigma.misc.animation.killAll(L),a=i(t.touches[0]),a=L.cameraPosition(a.x-t.target.width/2,a.y-t.target.height/2,!0),sigma.misc.animation.camera(L,{x:a.x*(1-o)+L.x,y:a.y*(1-o)+L.y,ratio:n},{easing:e?"quadraticOut":"quadraticInOut",duration:P("doubleClickZoomDuration"),onComplete:function(){k=!1}})),t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation(),!1):void 0}var c,u,h,g,d,l,m,x,y,v,p,f,M,E,w,b,k,D,T=this,q=t,L=a,P=e,C=[];sigma.classes.dispatcher.extend(this),sigma.utils.doubleClick(q,"touchstart",s),q.addEventListener("touchstart",o),q.addEventListener("touchend",n),q.addEventListener("touchcancel",n),q.addEventListener("touchleave",n),q.addEventListener("touchmove",r)}}).call(this);